{% extends "_partials/dashboard_teacher/layaout.html" %}
{% load static %}

{% block content %}
    <!-- Assistance Section -->
    <h4 class="text-color-pink">GRADEBOOK</h4>
    <div class="gradebook-container">
        <div class="content">
            <div class="content-header">
                <div class="button-group" id="button-group">
                    <button class="button button-add-new-item" onclick="toggleForm()">
                        <i class="bi bi-clipboard-data white"></i> <span>Add New Item</span>
                    </button>
                    <a href="{% url 'gradebook_calculation' %}">
                        <button class="button button-calculations">
                            <i class="bi bi-gear white"></i> <span>Calculations</span>
                        </button>
                    </a>
                    <a href="">
                        <button class="button button-layout">
                            <i class="bi bi-layout-text-sidebar white"></i>
                            <span>Layout</span>
                        </button>
                    </a>
                    <a href="{% url 'generate_pdf' %}">
                        <button class="button button-print">
                            <i class="bi bi-printer white"></i>
                            <span>Digital library</span>
                        </button>
                    </a>
                </div>
                <select class="dropdown">
                    {% for class in classes %}
                        <option value="{{ class.id }}">{{ class.name }}</option>
                    {% endfor %}
                </select>
                <a href="">
                    <button class="button button-fa-sliders">
                        <i class="bi bi-sliders noir"></i>
                    </button>
                </a>
            </div>

            <!-- Formulaire d'ajout -->
            <div id="add-item-form" style="display: flex; margin-top: 20px;">
                <form method="POST" action="{% url 'create_gradebook' %}" style="display: flex; align-items: center; gap: 10px;">
                    {% csrf_token %}
                    <input type="text" id="student_name" name="student_name" placeholder="Student Name" required style="flex: 1;">
                    <input type="text" id="assignment_title" name="assignment_title" placeholder="Assignment Title" required style="flex: 1;">
                    <input type="number" id="score" name="score" placeholder="Score" required style="flex: 1;">
                    <textarea id="feedback" name="feedback" placeholder="Feedback" style="flex: 1; resize: none; height: 40px;"></textarea>
                    <button type="submit" class="button button-apply">APPLY</button>
                </form>
            </div>

            <div class="table-container">
                <table class="gradebook-table">
                    <thead>
                        <tr class="header-row">
                            <th>STUDENT</th>
                            <th>AVERAGE</th>
                            <th>EXAM (3)</th>
                            <th>TESTS (2)</th>
                            <th>ASSIGNMENTS (14)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for gradebook in gradebooks %}
                            <tr class="{% if forloop.counter|divisibleby:2 %}white-row{% else %}colored-row{% endif %}">
                                <td>{{ gradebook.student.user.username }}</td>
                                <td>{{ gradebook.average }}%</td>
                                <td><span class="view-link">View</span><i class="bi bi-mic-fill red"></i></td>
                                <td><span class="view-link">View</span><i class="bi bi-mic-fill red"></i></td>
                                <td><span class="view-link">View</span><i class="bi bi-mic-fill red"></i></td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="5">Aucune entrée de gradebook trouvée.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        function toggleForm() {
            var buttonGroup = document.getElementById('button-group');
            var form = document.getElementById('add-item-form');

            if (form.style.display === 'none') {
                buttonGroup.style.display = 'none'; // Masquer les boutons
                form.style.display = 'flex'; // Afficher le formulaire
            } else {
                buttonGroup.style.display = 'flex'; // Afficher les boutons
                form.style.display = 'none'; // Masquer le formulaire
            }
        }
    </script>
{% endblock %}